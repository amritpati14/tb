<%= form_for @alert do |f| %>
  <table class="dashboard-table table table-bordered">
    <tbody>
      <thead>
        <tr><th colspan="2"><%= @alert.new_record? ? 'Add new alert' : @alert.name || @alert.event_type %></th></tr>
      </thead>
    <tr>
      <th>Name</th>
      <td><%= f.text_field :name %></td>
    </tr>
    <tr>
      <th>Type</th>
      <td><%= f.enum_select :event_type %></td>
    </tr>
    <tr class="alert_conditions">
      <th>Conditions</th>
      <td>
        <div class="time">
          <span>From</span> <%= f.text_field :restricted_time_start, :placeholder => 'Restricted time start', :alt => 'time' %>
          <span>till</span> <%= f.text_field :restricted_time_end, :placeholder => 'Restricted time end', :alt => 'time' %>
          <span class="error"><br><%= "Time format is invalid" if f.object.time_errors.present? %></span>
        </div>
        <div class="map">
          <%= render :partial => 'restrictions/map', :locals => {:f => f} %>
        </div>
        <span class="error"><%= f.object.errors[:restrictions] if f.object.errors[:restrictions].present? %></span>
      </td>
    </tr>
    <tr>
      <th>Phone list</th>
      <td>
        <% @family.phones.each do |phone| %>
          <div>
            <%= check_box_tag "alert[phone_ids][]", phone.id, f.object.phones.include?(phone) %>
            <%= phone.name || phone.user.name %>
          </div>
        <% end %>
      </td>
    </tr>
    <tr>
      <th>Contacts</th>
      <td>
        <% @family.parents.each do |parent| %>
          <div>
            <%= check_box_tag "alert[user_ids][]", parent.id, f.object.users.include?(parent) %>
            <%= parent.name || parent.email %>
          </div>
        <% end %>
      </td>
    </tr>
  </tbody>
</table>

<div class="modal-footer">
  <%= f.submit :class => "btn" %>
</div>
<% end %>

<% content_for :javascripts do %>
  <%= javascript_include_tag 'field_mask' %>
  <script>
    $(document).ready(function() {
      <% if @alert.event_type == :'Leaving area' %>
        $("tr.alert_conditions .time").addClass("invisible");
      <% else %>
        $("tr.alert_conditions .map").addClass("invisible");
      <% end %>

      $('input:text').setMask();
    
      $("select#alert_event_type").live("change", function() {
        $("tr.alert_conditions div").toggleClass("invisible");
      });
    });
  </script>
<% end %>

